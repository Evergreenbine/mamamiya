<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="app.vo.Circle">
    <!--    新建圈子-->
    <insert id="createCircle" parameterType="app.vo.Circle">
        insert into circle(cname, introduce,avator)
        value(#{cname},#{introduce},#{avator})
    </insert>

<!--    删除圈子-->
    <update id="deletecircle" parameterType="int">
        update circle set tag = 0 where  cid = #{cid}
    </update>
<!--    删除贴子-->
    <update id="deletepost" parameterType="map">
        update post set tag = 0 where 1=1
        <if test="cid != null">
            and cid = #{cid}
        </if>
        <if test="pid !=null">
            and pid = #{pid}
        </if>
    </update>
<!-- 列出所有圈子-->
    <select id="listCircle" parameterType="Integer" resultType="app.vo.Circle">
        select * from circle where tag = 1
        <if test="limit != null">
            limit #{limit} ;
        </if>

    </select>

<!--    创建贴子-->
    <insert id="createPost" parameterType="app.vo.Post">
        insert  into post(title, author, content, time, useraccount, cid) value (
        #{title},#{author},#{content},#{time},#{useraccount},#{cid}
        )
    </insert>

<!--    关注圈子-->
    <insert id="focuscircle" parameterType="map">
        insert into follow(cid, useraccount) value (#{cid},#{useraccount})
    </insert>
<!--    取消关注圈子-->
    <delete id="nofollow" parameterType="map">
        delete from follow where cid = #{cid} and useraccount = #{useraccount}
    </delete>
<!--    查询某人是否关注圈子-->
    <select id="isfocuscircle" parameterType="map" resultType="int">
        select count(*) from follow where cid = #{cid} and useraccount = #{useraccount}
    </select>



<!--    查询所有贴子-->
    <select id="queryPost" parameterType="map" resultType="app.vo.Post">
        select * from post p ,user u where p.useraccount = u.useraccount and p.cid = #{cid} and p.tag = 1
        <if test="pid != null">
             and p.pid = #{pid}
        </if>
        <if test="useraccount != null">
            and u.useraccount = #{useraccount}
        </if>
    </select>

<!--    查询圈子的关注人数-->
    <select id="follonums" parameterType="int" resultType="app.vo.Circle">
        select  count(*) as "follownums" from follow where cid = #{cid}
    </select>


<!--    知识的-->
<!--    查询指定id-->
    <select id="queryKonwById" parameterType="int" resultType="app.vo.KnowlegeVo">
        select * from konwledge
        where kid = #{kid};
    </select>

<!--    根据分类查询所有知识-->
    <select id="querykonw" resultType="app.vo.KnowlegeVo">
        select * from konwledge where cata = #{cid}
    </select>
<!--    查看该用户对应的知识是否免费-->
    <select id="queryIsFree" parameterType="map" resultType="map">
        select * from konwuser where kid = #{kid} and userid = #{useraccount}
    </select>


<!--    知识付费-->
    <insert id="purchasekonw" parameterType="map" >
        insert into konwuser(kid, userid) value (#{kid},#{useraccount})
    </insert>
    <update id="demoney" parameterType="map">
        update user set monney = #{monney} where useraccount = #{useraccount}
    </update>
    <select id="getmoney" parameterType="int" resultType="double">
        select monney from user where useraccount = #{useraccount}
    </select>

<!--    查询问题分类-->
    <select id="queryQuesCata"  resultType="app.vo.Qcata">
        select * from qcata;
    </select>

<!--    新建提问-->
    <insert id="createques" parameterType="app.vo.Question">
        insert into question(useraccount, title, content, qcid, createtime)
        value(#{useraccount},#{title},#{content},#{qcid},#{createtime})
    </insert>

<!--    按类型查询问题-->
    <select id="queryQuesbycata" parameterType="map" resultType="app.vo.Question">
        select * from question q,user u where  q.useraccount = u.useraccount and qcid = #{qcid}
    </select>

<!--    按qid查找问题-->
    <select id="quesryQuesByqid" parameterType="map" resultType="app.vo.Question">
         select * from question q,user u where  q.useraccount = u.useraccount and qid = #{qid}
    </select>

<!--    按qid 查找回复-->
    <select id="quesreply" parameterType="int" resultType="app.vo.Reply">
        select * from reply r ,user u where r.useraccount = u.useraccount and r.qid = #{qid}
    </select>

<!--    回复信息-->
    <insert id="createreply" parameterType="app.vo.Reply">
        insert into  reply(ruid, useraccount, content, qid, createtime)
        value (#{ruid},#{useraccount},#{content},#{qid},#{createtime})
    </insert>

<!--    回复贴子-->
    <insert id="createreplypost" parameterType="app.vo.ReplyPost">
        insert into replypost(useraccount, content, pid, createtime, ruid)
        value (#{useraccount},#{content},#{pid},#{createtime},#{ruid})
    </insert>

<!--    查询所有回复的贴子-->
    <select id="querypost" parameterType="map" resultType="app.vo.ReplyPost">
        select * from replypost r,user u where r.useraccount = u.useraccount and r.tag =1 and u.tag = 1 and pid = #{pid};
    </select>


</mapper>